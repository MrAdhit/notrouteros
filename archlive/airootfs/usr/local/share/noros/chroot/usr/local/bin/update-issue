#!/bin/bash

ISSUE_FILE="/etc/issue"

cat > "$ISSUE_FILE" << 'EOF'
      [0;1;32;92m__[0;1;36;96m_[0m           [0;1;36;96m__[0;1;34;94m_[0m           [0;1;34;94m__[0;1;35;95m_[0m           [0;1;35;95m__[0;1;31;91m_[0m           [0;1;31;91m__[0;1;33;93m_[0m     
     [0;1;32;92m/[0;1;36;96m\\_[0;1;34;94m_\\[0m         [0;1;36;96m/[0;1;34;94m\\[0m  [0;1;35;95m\\[0m         [0;1;34;94m/[0;1;35;95m\\[0m  [0;1;31;91m\\[0m         [0;1;35;95m/[0;1;31;91m\\[0m  [0;1;33;93m\\[0m         [0;1;31;91m/[0;1;33;93m\\[0m  [0;1;32;92m\\[0m    
    [0;1;36;96m/:[0;1;34;94m:|[0m  [0;1;31;91m|[0m       [0;1;34;94m/:[0;1;35;95m:\\[0m  [0;1;33;93m\\[0m       [0;1;35;95m/:[0;1;31;91m:\\[0m  [0;1;32;92m\\[0m       [0;1;31;91m/:[0;1;33;93m:\\[0m  [0;1;36;96m\\[0m       [0;1;33;93m/:[0;1;32;92m:\\[0m  [0;1;34;94m\\[0m   
   [0;1;36;96m/[0;1;34;94m:|[0;1;35;95m:|[0m  [0;1;33;93m|[0m      [0;1;34;94m/[0;1;35;95m:/[0;1;31;91m\\:[0;1;33;93m\\[0m  [0;1;32;92m\\[0m     [0;1;35;95m/[0;1;31;91m:/[0;1;33;93m\\:[0;1;32;92m\\[0m  [0;1;36;96m\\[0m     [0;1;31;91m/[0;1;33;93m:/[0;1;32;92m\\:[0;1;36;96m\\[0m  [0;1;34;94m\\[0m     [0;1;33;93m/[0;1;32;92m:/[0;1;36;96m\\[0m [0;1;34;94m\\[0m  [0;1;35;95m\\[0m  
  [0;1;34;94m/:[0;1;35;95m/|[0;1;31;91m:|[0m  [0;1;32;92m|_[0;1;36;96m_[0m   [0;1;35;95m/:[0;1;31;91m/[0m  [0;1;33;93m\\[0;1;32;92m:\\[0m  [0;1;34;94m\\[0m   [0;1;31;91m/:[0;1;33;93m:\\[0;1;32;92m~\\[0;1;36;96m:\\[0m  [0;1;35;95m\\[0m   [0;1;33;93m/:[0;1;32;92m/[0m  [0;1;36;96m\\[0;1;34;94m:\\[0m  [0;1;31;91m\\[0m   [0;1;32;92m_\\[0;1;36;96m:\\[0;1;34;94m~\\[0m [0;1;35;95m\\[0m  [0;1;33;93m\\[0m 
 [0;1;34;94m/[0;1;35;95m:/[0m [0;1;31;91m|[0;1;33;93m:|[0m [0;1;32;92m/[0;1;36;96m\\_[0;1;34;94m_\\[0m [0;1;35;95m/[0;1;31;91m:/[0;1;33;93m__[0;1;32;92m/[0m [0;1;36;96m\\:[0;1;34;94m\\_[0;1;35;95m_\\[0m [0;1;31;91m/[0;1;33;93m:/[0;1;32;92m\\:[0;1;36;96m\\[0m [0;1;34;94m\\:[0;1;35;95m\\_[0;1;31;91m_\\[0m [0;1;33;93m/[0;1;32;92m:/[0;1;36;96m__[0;1;34;94m/[0m [0;1;35;95m\\:[0;1;31;91m\\_[0;1;33;93m_\\[0m [0;1;32;92m/[0;1;36;96m\\[0m [0;1;34;94m\\:[0;1;35;95m\\[0m [0;1;31;91m\\[0m [0;1;33;93m\\_[0;1;32;92m_\\[0m
 [0;1;35;95m\\[0;1;31;91m/_[0;1;33;93m_|[0;1;32;92m:|[0;1;36;96m/:[0;1;34;94m/[0m  [0;1;35;95m/[0m [0;1;31;91m\\[0;1;33;93m:\\[0m  [0;1;36;96m\\[0m [0;1;34;94m/:[0;1;35;95m/[0m  [0;1;31;91m/[0m [0;1;33;93m\\[0;1;32;92m/_[0;1;36;96m|:[0;1;34;94m:\\[0;1;35;95m/:[0;1;31;91m/[0m  [0;1;33;93m/[0m [0;1;32;92m\\[0;1;36;96m:\\[0m  [0;1;35;95m\\[0m [0;1;31;91m/:[0;1;33;93m/[0m  [0;1;32;92m/[0m [0;1;36;96m\\[0;1;34;94m:\\[0m [0;1;35;95m\\[0;1;31;91m:\\[0m [0;1;33;93m\\[0;1;32;92m/_[0;1;36;96m_/[0m
     [0;1;32;92m|[0;1;36;96m:/[0;1;34;94m:/[0m  [0;1;31;91m/[0m   [0;1;32;92m\\:[0;1;36;96m\\[0m  [0;1;34;94m/[0;1;35;95m:/[0m  [0;1;33;93m/[0m     [0;1;34;94m|:[0;1;35;95m|:[0;1;31;91m:/[0m  [0;1;32;92m/[0m   [0;1;34;94m\\:[0;1;35;95m\\[0m  [0;1;31;91m/[0;1;33;93m:/[0m  [0;1;36;96m/[0m   [0;1;35;95m\\:[0;1;31;91m\\[0m [0;1;33;93m\\:[0;1;32;92m\\_[0;1;36;96m_\\[0m  
     [0;1;36;96m|[0;1;34;94m::[0;1;35;95m/[0m  [0;1;31;91m/[0m     [0;1;36;96m\\[0;1;34;94m:\\[0;1;35;95m/:[0;1;31;91m/[0m  [0;1;33;93m/[0m      [0;1;35;95m|:[0;1;31;91m|\\[0;1;33;93m/_[0;1;32;92m_/[0m     [0;1;35;95m\\[0;1;31;91m:\\[0;1;33;93m/:[0;1;32;92m/[0m  [0;1;36;96m/[0m     [0;1;31;91m\\[0;1;33;93m:\\[0;1;32;92m/:[0;1;36;96m/[0m  [0;1;34;94m/[0m  
     [0;1;34;94m/[0;1;35;95m:/[0m  [0;1;33;93m/[0m       [0;1;35;95m\\:[0;1;31;91m:/[0m  [0;1;32;92m/[0m       [0;1;31;91m|:[0;1;33;93m|[0m  [0;1;32;92m|[0m        [0;1;33;93m\\:[0;1;32;92m:/[0m  [0;1;34;94m/[0m       [0;1;32;92m\\:[0;1;36;96m:/[0m  [0;1;35;95m/[0m   
     [0;1;35;95m\\[0;1;31;91m/_[0;1;33;93m_/[0m         [0;1;31;91m\\[0;1;33;93m/_[0;1;32;92m_/[0m         [0;1;33;93m\\[0;1;32;92m|_[0;1;36;96m_|[0m         [0;1;32;92m\\[0;1;36;96m/_[0;1;34;94m_/[0m         [0;1;36;96m\\[0;1;34;94m/_[0;1;35;95m_/[0m    

EOF

echo -e "Kernel: \\r on \\m" >> "$ISSUE_FILE"
echo "" >> "$ISSUE_FILE"

echo "Network Interfaces:" >> "$ISSUE_FILE"
echo "-------------------" >> "$ISSUE_FILE"

GREEN='\033[0;32m'
RED='\033[0;31m'
RESET='\033[0m'

while IFS= read -r line; do
    iface=$(echo "$line" | awk '{print $2}' | tr -d ':')

    [[ "$iface" == "lo" ]] && continue
    
    mapfile -t ipv4_addrs < <(ip -4 addr show "$iface" 2>/dev/null | grep -oP 'inet \K[\d.]+(/\d+)?')
    mapfile -t ipv6_addrs < <(ip -6 addr show "$iface" 2>/dev/null | grep -oP 'inet6 \K[^\s]+' | grep -v '^fe80')
    
    state=$(ip link show "$iface" 2>/dev/null | grep -oP 'state \K\w+')
    
    if [[ "$state" == "UP" ]]; then
        color="$GREEN"
    else
        color="$RED"
    fi
    
    max_rows=${#ipv4_addrs[@]}
    [[ ${#ipv6_addrs[@]} -gt $max_rows ]] && max_rows=${#ipv6_addrs[@]}
    
    if [[ $max_rows -eq 0 ]]; then
        printf "  ${color}%-8s${RESET} -\n" "$iface" >> "$ISSUE_FILE"
    else
        for ((i=0; i<max_rows; i++)); do
            if [[ $i -eq 0 ]]; then
                printf "  ${color}%-8s${RESET} " "$iface" >> "$ISSUE_FILE"
            else
                printf "           " >> "$ISSUE_FILE"
            fi
            
            if [[ -n "${ipv4_addrs[$i]}" ]]; then
                printf "%-20s " "${ipv4_addrs[$i]}" >> "$ISSUE_FILE"
            else
                printf "%-20s " "" >> "$ISSUE_FILE"
            fi
            
            if [[ -n "${ipv6_addrs[$i]}" ]]; then
                printf "%s" "${ipv6_addrs[$i]}" >> "$ISSUE_FILE"
            fi
            
            echo "" >> "$ISSUE_FILE"
        done
    fi
done < <(ip link show | grep -E '^[0-9]+:')

echo "" >> "$ISSUE_FILE"
echo "Login on \\l" >> "$ISSUE_FILE"
echo "" >> "$ISSUE_FILE"
